# Neo4j Graph Schema for CatGraphNX Data

This document outlines the Neo4j graph schema generated by the `CATDA/tools/neo4j/neo4j_import.py` script. The script processes JSON/JSON5 files containing catalysis experiment data (synthesis and testing) and imports them into a Neo4j database.

## Node Labels

Nodes represent the core entities extracted from the experimental data.

1.  **`Paper`**
    *   **Description:** Represents the source scientific paper or document from which the data was extracted. Acts as a global entry point for data from a specific source.
    *   **Key Properties:**
        *   `name`: (String, **Unique**) The identifier for the paper (usually derived from the input filename).
    *   **Origin:** Created once per input file/paper.

2.  **`Chemical`**
    *   **Description:** Represents a chemical substance involved in the synthesis process *that is not identified as a catalyst*. Can be a reactant, solvent, precursor, or intermediate product. These nodes are specific to the paper they originate from.
    *   **Key Properties:**
        *   `original_id`: (String, **Unique**) Composite ID: `{paper_name}_{json_node_id}`.
        *   `json_id`: (String) The original ID from the source JSON file.
        *   `paper_name`: (String) The name of the paper this node belongs to.
        *   `original_type`: (String) The original type string from the JSON (e.g., "chemical").
        *   `name`: (String) The primary name of the chemical.
        *   `formula`: (String, Optional) Chemical formula, stored directly if present.
        *   `aliases`: (String, Optional) JSON string representation of the list of aliases.
        *   *Flattened Composition*: Properties from the source `composition` dictionary are flattened with the prefix `composition_` (e.g., `composition_Pt_wt%`, `composition_SiO2_wt%`).
        *   *Flattened Properties*: Properties from the source `properties` dictionary are flattened with the prefix `property_` (e.g., `property_surface_area_m2-per-g`, `property_particle_size_nm`).
        *   *Other scalar properties* from the source JSON are stored directly.
        *   *List properties* are stored as JSON strings.
    *   **Origin:** Created from `nodes` in the `synthesis` or `catgraph_tree` sections of the JSON where `type` is "chemical" and `is_catalyst` (or `is_tested_catalyst`) is not true.

3.  **`Catalyst`**
    *   **Description:** Represents a chemical substance specifically identified or used as a catalyst, typically in the testing phase. These nodes are specific to the paper they originate from.
    *   **Key Properties:**
        *   `original_id`: (String, **Unique**) Composite ID: `{paper_name}_{json_node_id}`.
        *   `json_id`: (String) The original ID from the source JSON file.
        *   `paper_name`: (String) The name of the paper this node belongs to.
        *   `original_type`: (String) The original type string from the JSON (e.g., "chemical", "catalyst").
        *   `name`: (String) The name of the catalyst.
        *   `formula`: (String, Optional) Chemical formula, stored directly if present.
        *   `aliases`: (String, Optional) JSON string representation of the list of aliases.
        *   *Flattened Composition*: Properties from the source `composition` dictionary are flattened with the prefix `composition_` (e.g., `composition_Pt_wt%`, `composition_Al2O3_wt%`).
        *   *Flattened Properties*: Properties from the source `properties` dictionary are flattened with the prefix `property_` (e.g., `property_BET_surface_area_m2-per-g`, `property_pore_volume_cm3-per-g`).
        *   *Other scalar properties* from the source JSON are stored directly.
        *   *List properties* are stored as JSON strings.
        *   Note: The `is_catalyst` flag from the source JSON determines the node label but is not typically stored as a direct property.
    *   **Origin:** Created from `nodes` in the JSON where `type` is "chemical" and `is_catalyst` (or `is_tested_catalyst`) is true, *or* where `type` is explicitly "catalyst".

4.  **`BasicMaterial`**
    *   **Description:** Represents a fundamental chemical component or element, often derived from the formula or composition of a `Chemical` or `Catalyst`. These nodes are intended to be global (shared across papers).
    *   **Key Properties:**
        *   `name`: (String, **Unique**) The cleaned name of the basic material (e.g., chemical formula, element symbol, or cleaned chemical name). Used as the primary identifier.
        *   `original_id`: (String) Same as `name`.
    *   **Origin:**
        *   Created implicitly when processing eligible `Chemical` or `Catalyst` nodes (starting materials or catalysts) based on the following priority from the *original* (non-flattened) JSON data:
            1.  `chemical formula` (or `formula`) property.
            2.  Keys in the `composition` dictionary.
            3.  `name` property (only for `Chemical` nodes, not `Catalyst` nodes).
        *   Names are cleaned by removing parenthetical content (e.g., "Al2O3 (anhydrous)" -> "Al2O3").
        *   Can also be created if a node explicitly has `type: "basic_material"` in the source JSON (less common case based on script logic).

5.  **`Synthesis`**
    *   **Description:** Represents a specific synthesis step or procedure described in the paper. Paper-specific.
    *   **Key Properties:**
        *   `original_id`: (String, **Unique**) Composite ID: `{paper_name}_{json_node_id}`.
        *   `json_id`: (String) The original ID from the source JSON file.
        *   `paper_name`: (String) The name of the paper this node belongs to.
        *   `original_type`: (String) "synthesis".
        *   `name`: (String) Name or description of the synthesis step.
        *   `procedure`: (String) Verbatim procedure description.
        *   `method`: (String) Synthesis method description.
        *   `source_text`: (String) Verbatim quote anchoring the step.
        *   `synthesis_level`: (Integer, Optional) Topological level in the synthesis DAG.
        *   *Flattened Conditions*: Properties from the source `conditions` dictionary are flattened with the prefix `condition_` (e.g., `condition_temperature_C`, `condition_time_h`, `condition_pH_NoUnit`).
        *   *Other scalar properties* from the source JSON are stored directly.
        *   *List properties* are stored as JSON strings.
    *   **Origin:** Created from `nodes` in the `synthesis` or `catgraph_tree` sections where `type` is "synthesis".

6.  **`Testing`**
    *   **Description:** Represents a specific testing experiment or performance evaluation performed, usually on a catalyst. Paper-specific.
    *   **Key Properties:**
        *   `original_id`: (String, **Unique**) Composite ID: `{paper_name}_{json_node_id}`.
        *   `json_id`: (String) The original ID from the source JSON file.
        *   `paper_name`: (String) The name of the paper this node belongs to.
        *   `original_type`: (String) "testing".
        *   `description`: (String) Description of the test.
        *   `catalyst_id`: (String) Original JSON ID of the catalyst tested (Note: Use the `TESTED_IN` relationship for graph traversal).
        *   `source_text`: (String) Verbatim quote anchoring this test in the source text.
        *   *Flattened Conditions*: Properties from the source `conditions_json` dictionary are flattened with the prefix `condition_` (e.g., `condition_temperature_C`, `condition_pressure_bar`, `condition_WHSV_h-1`, `condition_feed_composition_CO_pct`).
        *   *Flattened Results*: Properties from the source `results_json` dictionary are flattened with the prefix `result_` (e.g., `result_conversion_pct`, `result_selectivity_C2H4_pct`, `result_yield_NoUnit`, `result_stability_h`).
        *   *Other scalar properties* from the source JSON are stored directly.
        *   *List properties* are stored as JSON strings.
    *   **Origin:** Created from `nodes` in the `testing` or `catgraph_tree` sections where `type` is "testing".

7.  **`UnknownNode`**
    *   **Description:** A fallback label for nodes where the `type` specified in the JSON is not recognized in `NODE_TYPE_MAP`. Paper-specific.
    *   **Key Properties:**
        *   `original_id`: (String, **Unique**) Composite ID: `{paper_name}_{json_node_id}`.
        *   `json_id`: (String) The original ID from the source JSON file.
        *   `paper_name`: (String) The name of the paper this node belongs to.
        *   `original_type`: (String) The unrecognized type string from the JSON.
        *   *Flattened/Stored Properties*: Properties from the JSON node are flattened if dictionaries (using mapped prefixes like `property_`, `condition_`, `result_` or the original key as fallback), stored as JSON strings if lists, or stored directly if scalars.
    *   **Origin:** Created when a node's `type` in the JSON does not map to a known label.

## Relationship Types

Relationships connect the nodes, representing how the entities interact. Properties on relationships are also flattened.

1.  **`(Chemical)-[:SYNTHESIS_INPUT]->(Synthesis)`**
    *   **Description:** Indicates a chemical substance was used as an input (reactant, precursor, solvent, etc.) for a synthesis step.
    *   **Properties:**
        *   `original_id`, `original_type`, `paper_name` (stored directly).
        *   Properties from the source edge's `properties` dictionary are flattened using `property_` as prefix (e.g., `property_role`, `property_amount_value`, `property_amount_unit`).
        *   Scalar properties from the source edge are stored directly.
        *   List properties are stored as JSON strings.

2.  **`(Synthesis)-[:SYNTHESIS_OUTPUT]->(Chemical)`** or **`(Synthesis)-[:SYNTHESIS_OUTPUT]->(Catalyst)`**
    *   **Description:** Indicates a chemical substance or catalyst was produced as the output of a synthesis step.
    *   **Properties:**
        *   `original_id`, `original_type`, `paper_name` (stored directly).
        *   Properties from the source edge's `properties` dictionary are flattened using `property_` as prefix (e.g., `property_form`, `property_yield_value`, `property_yield_unit`).
        *   Scalar properties from the source edge are stored directly.
        *   List properties are stored as JSON strings.

3.  **`(Catalyst)-[:TESTED_IN]->(Testing)`**
    *   **Description:** Indicates a catalyst was evaluated in a specific testing experiment.
    *   **Properties:**
        *   `original_id`, `original_type`, `paper_name` (stored directly).
        *   Properties from the source edge's `properties` dictionary are flattened using `property_` as prefix (e.g., `property_catalyst_amount_mg`, `property_pretreatment_details`).
        *   Scalar properties from the source edge are stored directly.
        *   List properties are stored as JSON strings.

4.  **`(Catalyst)-[:APPEAR_IN]->(Paper)`**
    *   **Description:** Explicitly links a catalyst node (specific to a paper) back to its source `Paper` node.
    *   **Properties:** None specified beyond standard Neo4j internal properties.
    *   **Origin:** Created implicitly when a `Catalyst` node is created.

5.  **`(Chemical)-[:WITH_BASICMATERIAL]->(BasicMaterial)`** or **`(Catalyst)-[:WITH_BASICMATERIAL]->(BasicMaterial)`**
    *   **Description:** Links a chemical or catalyst to its constituent basic material(s), derived from formula, composition, or name from the *original* JSON.
    *   **Properties:**
        *   `source_property`: (String) Indicates the origin ('formula', 'composition', or 'name').
        *   `value`: (Varies) The value associated with the component (e.g., percentage) if derived from `composition`.
        *   `unit`: (String) The unit associated with the `value` if derived from `composition`.
    *   **Origin:** Created implicitly during the processing of eligible `Chemical` and `Catalyst` nodes based on their original properties *before* flattening.

6.  **`(Node)-[:RELATED_TO]->(Node)`**
    *   **Description:** A default fallback relationship type used if the relationship `type` specified in the source JSON edge is not found in `EDGE_TYPE_MAP`. The specific source/target labels depend on the nodes being connected in the JSON.
    *   **Properties:**
        *   `original_id`, `original_type`, `paper_name` (stored directly).
        *   Properties from the source edge's `properties` dictionary are flattened (likely using `property_` prefix if the key is 'properties', otherwise the original key). 
        *   Scalar properties from the source edge are stored directly.
        *   List properties are stored as JSON strings.

## Constraints

Unique constraints are applied to ensure data integrity and improve query performance.

*   `Paper(name)`
*   `Chemical(original_id)`
*   `Catalyst(original_id)`
*   `BasicMaterial(name)`
*   `Synthesis(original_id)`
*   `Testing(original_id)`
*   `UnknownNode(original_id)`

**Note:** `original_id` for paper-specific nodes (`Chemical`, `Catalyst`, `Synthesis`, `Testing`, `UnknownNode`) is a composite key formatted as `{paper_name}_{json_node_id}`. For `BasicMaterial`, the `name` itself serves as the unique identifier. 